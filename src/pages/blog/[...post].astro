---
import { getCollection, render } from "astro:content"
import PgLayout from "../../layouts/Post.astro"
import { type ReadTimeResults } from "reading-time"
import { toString } from "mdast-util-to-string"

export async function getStaticPaths() {
    const posts = await getCollection("posts")
    return posts.map(post => ({
        params: { post: post.id },
        props: { post },
    }))
}

const { post } = Astro.props
const { Content, remarkPluginFrontmatter } = (await render(post)) as Omit<
    Awaited<ReturnType<typeof render>>,
    "remarkPluginFrontmatter"
> & {
    remarkPluginFrontmatter: typeof post.data & {
        readTime: ReadTimeResults
    }
}
---

<PgLayout frontmatter={remarkPluginFrontmatter} pageType="posts">
    <Content />
</PgLayout>
